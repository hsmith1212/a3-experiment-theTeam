<!DOCTYPE html>
<div id="container"></div>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<script type="module">
    console.log('working')
    const width = 500;
    const height = 250;
    const margin = {top: 10, right: 30, bottom: 30, left: 90};
    // place holders for now, will replace when we actually have the errors
    const logerrors = [1, 1.5, 2];
    const confidenceIntervals = [
        [0.8, 1.2],
        [1.3, 1.7],
        [1.8, 2.2]
    ];

    const svg = d3.create('svg')
        .attr('width', width)
        .attr('height', height);

    svg.append('rect')
        .attr('width', width-margin.left - margin.right)
        .attr('height', height - margin.top - (margin.bottom * 2.2)) // give space for title and axis labels
        .attr('x', margin.left)
        .attr('y', margin.top)
        .attr('fill', '#D3D3D3'); //googled light gray hex code
    
    //for log errors and confidence intervals
    const xscale = d3.scaleLinear()
        .domain([0, 3]) //placeholder, will replace with actual log error range
        .range([margin.left, width - margin.right]);

    // making x axis and title
    // EDIT more attributes once we know the actual errors
    svg.append('g')
        .attr('transform', `translate(0, ${height - (margin.bottom * 2.2)})`) // increase margin to give space for title
        .call(d3.axisBottom(xscale));

    svg.append("text")
        .attr("text-anchor", "middle")
        .attr("x", width / 2)
        .attr("y", height - margin.bottom)
        .text("Log Errors");

    // putting dots for log errors
    const graphSpace = height - margin.top - (margin.bottom * 2.2); // calculate available space for graph
    const spacing = graphSpace / (logerrors.length + 1); // calculate spacing based on number of log errors
    const yVals = [graphSpace / 2 - spacing, graphSpace / 2, graphSpace / 2 + spacing].map(y => y + margin.top); // stagger y values for visibility

    svg.selectAll('circle')
        .data(logerrors)
        .enter()
        .append('circle')
        .attr('cx', d => xscale(d))
        .attr('cy', (d, i) => yVals[i]) // use staggered y values
        .attr('r', 5)
        .attr('fill', 'black');

    // putting confidence intervals
    // used Claude AI to edit this code. Originally was using 'line' instead of 'ci-line' and it was not working, but now it is. 
    // I now understand that selecting all 'line' elements would not work because the axis uses 'line' elements as well, 
    // so we need to give our confidence interval lines a specific class to select them properly.
    svg.selectAll('.ci-line')   // <-- was 'line'
        .data(confidenceIntervals)
        .enter()
        .append('line')
        .attr('class', 'ci-line')  // claude told me to add this
        .attr('x1', d => xscale(d[0]))
        .attr('x2', d => xscale(d[1]))
        .attr('y1', (d, i) => yVals[i])
        .attr('y2', (d, i) => yVals[i])
        .attr('stroke', 'black')
        .attr('stroke-width', 2);

    const capHeight = 10; // height of the end caps
    // left end caps
    svg.selectAll('.ci-cap-left')
        .data(confidenceIntervals)
        .enter()
        .append('line')
        .attr('class', 'ci-cap-left')
        .attr('x1', d => xscale(d[0]))
        .attr('x2', d => xscale(d[0]))
        .attr('y1', (d, i) => yVals[i] - capHeight / 2)
        .attr('y2', (d, i) => yVals[i] + capHeight / 2)
        .attr('stroke', 'black')
        .attr('stroke-width', 2);

    // right end caps
    svg.selectAll('.ci-cap-right')
        .data(confidenceIntervals)
        .enter()
        .append('line')
        .attr('class', 'ci-cap-right')
        .attr('x1', d => xscale(d[1]))
        .attr('x2', d => xscale(d[1]))
        .attr('y1', (d, i) => yVals[i] - capHeight / 2)
        .attr('y2', (d, i) => yVals[i] + capHeight / 2)
        .attr('stroke', 'black')
        .attr('stroke-width', 2);

    console.log(xscale(confidenceIntervals[0][0]), xscale(confidenceIntervals[0][1]));

    // adding the labels for each log
    const label = ['Black & White', 'Multicolor', 'Gradient'];
    svg.selectAll('.chart-label')
        .data(label)
        .enter()
        .append('text')
        .attr('class', 'ci-label')
        .attr('x', margin.left - 5) // position labels on the left side
        .attr('y', (d, i) => yVals[i] + 5) // align with confidence intervals
        .text(d => d)
        .attr('font-size', '14px')
        .attr('fill', 'black')
        .attr('text-anchor', 'end'); // align text to the right


    //send visualization to the container
    d3.select("#container").append(() => svg.node());    
    
</script>